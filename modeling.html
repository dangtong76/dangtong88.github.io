<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Modeling | BigData with R</title>
  <meta name="description" content="R" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Modeling | BigData with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Modeling | BigData with R" />
  
  <meta name="twitter:description" content="R" />
  

<meta name="author" content="HyunChang Byun" />


<meta name="date" content="2019-09-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ggplot-visualization.html">
<link rel="next" href="modeling-part-2.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="libs/klippy-0.0.0.9500/js/klippy.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
<link rel="stylesheet" href="fontawesome.min.css" type="text/css" />
<link rel="stylesheet" href="bigdata.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R로 하는 빅데이터처리</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Bigdata with R</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> intro</a></li>
<li class="chapter" data-level="3" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html"><i class="fa fa-check"></i><b>3</b> Data Type and Structure</a><ul>
<li class="chapter" data-level="3.1" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-1"><i class="fa fa-check"></i><b>3.1</b> 변수(Variable)</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-2"><i class="fa fa-check"></i><b>3.1.1</b> 숫자(Numeric)</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-3"><i class="fa fa-check"></i><b>3.1.2</b> 문자()</a></li>
<li class="chapter" data-level="3.1.3" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-4"><i class="fa fa-check"></i><b>3.1.3</b> 팩터 (factor)</a></li>
<li class="chapter" data-level="3.1.4" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-5"><i class="fa fa-check"></i><b>3.1.4</b> 논리형(Logical)</a></li>
<li class="chapter" data-level="3.1.5" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-6"><i class="fa fa-check"></i><b>3.1.5</b> 날짜타입(Date and Datetime)</a></li>
<li class="chapter" data-level="3.1.6" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-7"><i class="fa fa-check"></i><b>3.1.6</b> NA/NaN/Inf 확인 및 처리</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-8"><i class="fa fa-check"></i><b>3.2</b> 데이터 구조(Data Structure)</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-9"><i class="fa fa-check"></i><b>3.2.1</b> 벡터 (Vector)</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-10"><i class="fa fa-check"></i><b>3.2.2</b> 리스트(List)</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-11"><i class="fa fa-check"></i><b>3.2.3</b> 행렬(Matrix)</a></li>
<li class="chapter" data-level="3.2.4" data-path="data-type-and-structure.html"><a href="data-type-and-structure.html#ClassID2-12"><i class="fa fa-check"></i><b>3.2.4</b> 데이타프레임(Data Frame)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html"><i class="fa fa-check"></i><b>4</b> Flowcontrol and Function</a><ul>
<li class="chapter" data-level="4.1" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#section-4.1"><i class="fa fa-check"></i><b>4.1</b> 흐름제어</a><ul>
<li class="chapter" data-level="4.1.1" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#if"><i class="fa fa-check"></i><b>4.1.1</b> if문</a></li>
<li class="chapter" data-level="4.1.2" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#ifelse"><i class="fa fa-check"></i><b>4.1.2</b> ifelse문</a></li>
<li class="chapter" data-level="4.1.3" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#else-if"><i class="fa fa-check"></i><b>4.1.3</b> else if문</a></li>
<li class="chapter" data-level="4.1.4" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#section-4.1.4"><i class="fa fa-check"></i><b>4.1.4</b> 연습문제</a></li>
<li class="chapter" data-level="4.1.5" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#for"><i class="fa fa-check"></i><b>4.1.5</b> for문</a></li>
<li class="chapter" data-level="4.1.6" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#while-"><i class="fa fa-check"></i><b>4.1.6</b> while 문</a></li>
<li class="chapter" data-level="4.1.7" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#while-next-"><i class="fa fa-check"></i><b>4.1.7</b> while-next 문</a></li>
<li class="chapter" data-level="4.1.8" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#repeat-"><i class="fa fa-check"></i><b>4.1.8</b> repeat 문</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="flowcontrol-and-function.html"><a href="flowcontrol-and-function.html#section-4.2"><i class="fa fa-check"></i><b>4.2</b> 연산자</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="function.html"><a href="function.html"><i class="fa fa-check"></i><b>5</b> Function</a><ul>
<li class="chapter" data-level="5.1" data-path="function.html"><a href="function.html#classID4-1"><i class="fa fa-check"></i><b>5.1</b> 함수</a></li>
<li class="chapter" data-level="5.2" data-path="function.html"><a href="function.html#classID4-2"><i class="fa fa-check"></i><b>5.2</b> 함수의 호출 특성</a></li>
<li class="chapter" data-level="5.3" data-path="function.html"><a href="function.html#classID4-3"><i class="fa fa-check"></i><b>5.3</b> 변수의 스코프(Scope)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="input-and-output.html"><a href="input-and-output.html"><i class="fa fa-check"></i><b>6</b> Input and Output</a><ul>
<li class="chapter" data-level="6.1" data-path="input-and-output.html"><a href="input-and-output.html#excel--"><i class="fa fa-check"></i><b>6.1</b> Excel 파일 읽기</a></li>
<li class="chapter" data-level="6.2" data-path="input-and-output.html"><a href="input-and-output.html#text--"><i class="fa fa-check"></i><b>6.2</b> TEXT 파일 읽기</a></li>
<li class="chapter" data-level="6.3" data-path="input-and-output.html"><a href="input-and-output.html#----api--"><i class="fa fa-check"></i><b>6.3</b> 공공데이터 포털 가입 하고 API 키 얻기</a><ul>
<li class="chapter" data-level="6.3.1" data-path="input-and-output.html"><a href="input-and-output.html#-"><i class="fa fa-check"></i><b>6.3.1</b> 회원 가입</a></li>
<li class="chapter" data-level="6.3.2" data-path="input-and-output.html"><a href="input-and-output.html#-"><i class="fa fa-check"></i><b>6.3.2</b> 일반회원으로 가입</a></li>
<li class="chapter" data-level="6.3.3" data-path="input-and-output.html"><a href="input-and-output.html#---"><i class="fa fa-check"></i><b>6.3.3</b> 회원가입을 위한 정보 입력</a></li>
<li class="chapter" data-level="6.3.4" data-path="input-and-output.html"><a href="input-and-output.html#-"><i class="fa fa-check"></i><b>6.3.4</b> 이용약관 동의</a></li>
<li class="chapter" data-level="6.3.5" data-path="input-and-output.html"><a href="input-and-output.html#section-6.3.5"><i class="fa fa-check"></i><b>6.3.5</b> 정보입력</a></li>
<li class="chapter" data-level="6.3.6" data-path="input-and-output.html"><a href="input-and-output.html#-"><i class="fa fa-check"></i><b>6.3.6</b> 회원가입 완료</a></li>
<li class="chapter" data-level="6.3.7" data-path="input-and-output.html"><a href="input-and-output.html#---api-"><i class="fa fa-check"></i><b>6.3.7</b> “국토부 실거래가”&quot; 로 API 검색</a></li>
<li class="chapter" data-level="6.3.8" data-path="input-and-output.html"><a href="input-and-output.html#------"><i class="fa fa-check"></i><b>6.3.8</b> “아파트매매 실거래 상세 자료” -&gt; 활용신청</a></li>
<li class="chapter" data-level="6.3.9" data-path="input-and-output.html"><a href="input-and-output.html#-"><i class="fa fa-check"></i><b>6.3.9</b> 활용신청 상세</a></li>
<li class="chapter" data-level="6.3.10" data-path="input-and-output.html"><a href="input-and-output.html#-"><i class="fa fa-check"></i><b>6.3.10</b> 신청현황 / 결과</a></li>
<li class="chapter" data-level="6.3.11" data-path="input-and-output.html"><a href="input-and-output.html#api--"><i class="fa fa-check"></i><b>6.3.11</b> API 정보 확인</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="input-and-output.html"><a href="input-and-output.html#api-----"><i class="fa fa-check"></i><b>6.4</b> API를 이용해 국토부 아파트매매 실거래가 가져오기</a></li>
<li class="chapter" data-level="6.5" data-path="input-and-output.html"><a href="input-and-output.html#api----2"><i class="fa fa-check"></i><b>6.5</b> API를 이용한 국토부 실거래가 조회2</a><ul>
<li class="chapter" data-level="6.5.1" data-path="input-and-output.html"><a href="input-and-output.html#-"><i class="fa fa-check"></i><b>6.5.1</b> 파일 불러오기</a></li>
<li class="chapter" data-level="6.5.2" data-path="input-and-output.html"><a href="input-and-output.html#----"><i class="fa fa-check"></i><b>6.5.2</b> 특정 구의 시군구 코드 알아내기</a></li>
<li class="chapter" data-level="6.5.3" data-path="input-and-output.html"><a href="input-and-output.html#------"><i class="fa fa-check"></i><b>6.5.3</b> 구군 명을 넣으면 구군코드를 반환하는 함수 만들기</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="input-and-output.html"><a href="input-and-output.html#google-----"><i class="fa fa-check"></i><b>6.6</b> Google 지도를 이용한 부동산 정보 시각화</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="data-transformation-1.html"><a href="data-transformation-1.html"><i class="fa fa-check"></i><b>7</b> Data transformation 1</a><ul>
<li class="chapter" data-level="7.1" data-path="data-transformation-1.html"><a href="data-transformation-1.html#data--"><i class="fa fa-check"></i><b>7.1</b> Data 변환 전에</a></li>
<li class="chapter" data-level="7.2" data-path="data-transformation-1.html"><a href="data-transformation-1.html#apply--"><i class="fa fa-check"></i><b>7.2</b> apply 계열의 함수들</a><ul>
<li class="chapter" data-level="7.2.1" data-path="data-transformation-1.html"><a href="data-transformation-1.html#apply"><i class="fa fa-check"></i><b>7.2.1</b> apply( )</a></li>
<li class="chapter" data-level="7.2.2" data-path="data-transformation-1.html"><a href="data-transformation-1.html#-------"><i class="fa fa-check"></i><b>7.2.2</b> 행 또는 열의 합 또는 평균 계산 함수</a></li>
<li class="chapter" data-level="7.2.3" data-path="data-transformation-1.html"><a href="data-transformation-1.html#lapply-"><i class="fa fa-check"></i><b>7.2.3</b> lapply( )함수</a></li>
<li class="chapter" data-level="7.2.4" data-path="data-transformation-1.html"><a href="data-transformation-1.html#unlist-"><i class="fa fa-check"></i><b>7.2.4</b> unlist 함수</a></li>
<li class="chapter" data-level="7.2.5" data-path="data-transformation-1.html"><a href="data-transformation-1.html#do.call-"><i class="fa fa-check"></i><b>7.2.5</b> do.call 함수</a></li>
<li class="chapter" data-level="7.2.6" data-path="data-transformation-1.html"><a href="data-transformation-1.html#sapply-"><i class="fa fa-check"></i><b>7.2.6</b> sapply 함수</a></li>
<li class="chapter" data-level="7.2.7" data-path="data-transformation-1.html"><a href="data-transformation-1.html#tapply-"><i class="fa fa-check"></i><b>7.2.7</b> tapply 함수</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="data-transformation-1.html"><a href="data-transformation-1.html#dplyr-"><i class="fa fa-check"></i><b>7.3</b> dplyr 패키지</a><ul>
<li class="chapter" data-level="7.3.1" data-path="data-transformation-1.html"><a href="data-transformation-1.html#flights---"><i class="fa fa-check"></i><b>7.3.1</b> flights 데이터셋의 간략한 설명</a></li>
<li class="chapter" data-level="7.3.2" data-path="data-transformation-1.html"><a href="data-transformation-1.html#filter-"><i class="fa fa-check"></i><b>7.3.2</b> Filter 사용하기</a></li>
<li class="chapter" data-level="7.3.3" data-path="data-transformation-1.html"><a href="data-transformation-1.html#logical-"><i class="fa fa-check"></i><b>7.3.3</b> Logical 연산자</a></li>
<li class="chapter" data-level="7.3.4" data-path="data-transformation-1.html"><a href="data-transformation-1.html#arrange---"><i class="fa fa-check"></i><b>7.3.4</b> arrange 를 이용한 정렬</a></li>
<li class="chapter" data-level="7.3.5" data-path="data-transformation-1.html"><a href="data-transformation-1.html#select----"><i class="fa fa-check"></i><b>7.3.5</b> select 를 이용한 데이터 선택</a></li>
<li class="chapter" data-level="7.3.6" data-path="data-transformation-1.html"><a href="data-transformation-1.html#year--day----"><i class="fa fa-check"></i><b>7.3.6</b> year 와 day 사이에 있는 컬럼 제외</a></li>
<li class="chapter" data-level="7.3.7" data-path="data-transformation-1.html"><a href="data-transformation-1.html#mutate----"><i class="fa fa-check"></i><b>7.3.7</b> mutate 로 새로운 컬럼 생성</a></li>
<li class="chapter" data-level="7.3.8" data-path="data-transformation-1.html"><a href="data-transformation-1.html#summarize---"><i class="fa fa-check"></i><b>7.3.8</b> summarize 로 집계 하기</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="data-transformation-1.html"><a href="data-transformation-1.html#sql----"><i class="fa fa-check"></i><b>7.4</b> SQL 이용한 관계형 데이터 처리</a></li>
<li class="chapter" data-level="7.5" data-path="data-transformation-1.html"><a href="data-transformation-1.html#mutating-----"><i class="fa fa-check"></i><b>7.5</b> mutating 조인을 이용한 관계형 데이터 처리</a><ul>
<li class="chapter" data-level="7.5.1" data-path="input-and-output.html"><a href="input-and-output.html#-"><i class="fa fa-check"></i><b>7.5.1</b> 데이터 살펴보기</a></li>
<li class="chapter" data-level="7.5.2" data-path="data-transformation-1.html"><a href="data-transformation-1.html#key"><i class="fa fa-check"></i><b>7.5.2</b> Key</a></li>
<li class="chapter" data-level="7.5.3" data-path="data-transformation-1.html"><a href="data-transformation-1.html#-----"><i class="fa fa-check"></i><b>7.5.3</b> 조인 실습을 위한 작은 데이터셋 만들기</a></li>
<li class="chapter" data-level="7.5.4" data-path="data-transformation-1.html"><a href="data-transformation-1.html#mutating-join-"><i class="fa fa-check"></i><b>7.5.4</b> Mutating Join ? 왜?</a></li>
<li class="chapter" data-level="7.5.5" data-path="data-transformation-1.html"><a href="data-transformation-1.html#join-"><i class="fa fa-check"></i><b>7.5.5</b> Join 이해하기</a></li>
<li class="chapter" data-level="7.5.6" data-path="data-transformation-1.html"><a href="data-transformation-1.html#inner-join-"><i class="fa fa-check"></i><b>7.5.6</b> Inner Join (내부조인)</a></li>
<li class="chapter" data-level="7.5.7" data-path="data-transformation-1.html"><a href="data-transformation-1.html#outer-join-"><i class="fa fa-check"></i><b>7.5.7</b> Outer Join (외부조인)</a></li>
<li class="chapter" data-level="7.5.8" data-path="data-transformation-1.html"><a href="data-transformation-1.html#section-7.5.8"><i class="fa fa-check"></i><b>7.5.8</b> 중복키</a></li>
<li class="chapter" data-level="7.5.9" data-path="data-transformation-1.html"><a href="data-transformation-1.html#join--"><i class="fa fa-check"></i><b>7.5.9</b> Join키 정의 하기</a></li>
<li class="chapter" data-level="7.5.10" data-path="data-transformation-1.html"><a href="data-transformation-1.html#flights----1"><i class="fa fa-check"></i><b>7.5.10</b> flights 테이블 조인 실습 하기1</a></li>
<li class="chapter" data-level="7.5.11" data-path="input-and-output.html"><a href="input-and-output.html#---"><i class="fa fa-check"></i><b>7.5.11</b> 필터링 조인 (세미조인 &amp; 안티조인)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="pipe.html"><a href="pipe.html"><i class="fa fa-check"></i><b>8</b> Pipe</a><ul>
<li class="chapter" data-level="8.1" data-path="pipe.html"><a href="pipe.html#pipe-"><i class="fa fa-check"></i><b>8.1</b> Pipe 란</a></li>
<li class="chapter" data-level="8.2" data-path="input-and-output.html"><a href="input-and-output.html#---"><i class="fa fa-check"></i><b>8.2</b> 파이프를 사용하기 위한 라이브러리</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html"><i class="fa fa-check"></i><b>9</b> Data Transpormation 2</a><ul>
<li class="chapter" data-level="9.1" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#tidy-"><i class="fa fa-check"></i><b>9.1</b> tidy 데이터</a></li>
<li class="chapter" data-level="9.2" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#gather---"><i class="fa fa-check"></i><b>9.2</b> gather 로 데이터 모으기</a></li>
<li class="chapter" data-level="9.3" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#spread---"><i class="fa fa-check"></i><b>9.3</b> spread 로 데이터 펼치기</a><ul>
<li class="chapter" data-level="9.3.1" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#gather--spread----"><i class="fa fa-check"></i><b>9.3.1</b> gather 와 spread 가 조금 다른 이유</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#seperate-unite"><i class="fa fa-check"></i><b>9.4</b> Seperate와 Unite</a><ul>
<li class="chapter" data-level="9.4.1" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#seperate--"><i class="fa fa-check"></i><b>9.4.1</b> seperate 로 나누기</a></li>
<li class="chapter" data-level="9.4.2" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#unite--"><i class="fa fa-check"></i><b>9.4.2</b> unite 로 합치기</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#na-"><i class="fa fa-check"></i><b>9.5</b> NA(결측값) 처리하기</a><ul>
<li class="chapter" data-level="9.5.1" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#--"><i class="fa fa-check"></i><b>9.5.1</b> 결측 처리 기본</a></li>
<li class="chapter" data-level="9.5.2" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#na--"><i class="fa fa-check"></i><b>9.5.2</b> NA(결측) 처리 자동화</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="data-transpormation-2.html"><a href="data-transpormation-2.html#-regular-expression"><i class="fa fa-check"></i><b>9.6</b> 정규 표현식(Regular Expression)</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html"><i class="fa fa-check"></i><b>10</b> ggplot visualization</a><ul>
<li class="chapter" data-level="10.1" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#ggplot--"><i class="fa fa-check"></i><b>10.1</b> ggplot 옵션 익히기</a><ul>
<li class="chapter" data-level="10.1.1" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#mpg-"><i class="fa fa-check"></i><b>10.1.1</b> mpg 데이터</a></li>
<li class="chapter" data-level="10.1.2" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#ClassID"><i class="fa fa-check"></i><b>10.1.2</b> 기본 그래프 생성 문법</a></li>
<li class="chapter" data-level="10.1.3" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-2"><i class="fa fa-check"></i><b>10.1.3</b> ggplot 문법 기본</a></li>
<li class="chapter" data-level="10.1.4" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-3"><i class="fa fa-check"></i><b>10.1.4</b> 간단한 그래프 그리기</a></li>
<li class="chapter" data-level="10.1.5" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-4"><i class="fa fa-check"></i><b>10.1.5</b> 선그래프 추가하기</a></li>
<li class="chapter" data-level="10.1.6" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-5"><i class="fa fa-check"></i><b>10.1.6</b> X, Y 각 축에 값 제한 하기</a></li>
<li class="chapter" data-level="10.1.7" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-6"><i class="fa fa-check"></i><b>10.1.7</b> 그래프 확대 하기</a></li>
<li class="chapter" data-level="10.1.8" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-8"><i class="fa fa-check"></i><b>10.1.8</b> 타이틀 및 축라벨 변경</a></li>
<li class="chapter" data-level="10.1.9" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-9"><i class="fa fa-check"></i><b>10.1.9</b> 색상과 점의 크기 조정</a></li>
<li class="chapter" data-level="10.1.10" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-10"><i class="fa fa-check"></i><b>10.1.10</b> 조건기반 색상 표시</a></li>
<li class="chapter" data-level="10.1.11" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-11"><i class="fa fa-check"></i><b>10.1.11</b> 그룹별로 색상 표시하기</a></li>
<li class="chapter" data-level="10.1.12" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID3-12"><i class="fa fa-check"></i><b>10.1.12</b> col 인자에 명기 하는 경우</a></li>
<li class="chapter" data-level="10.1.13" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-14"><i class="fa fa-check"></i><b>10.1.13</b> Mark 의 모양 변경</a></li>
<li class="chapter" data-level="10.1.14" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-15"><i class="fa fa-check"></i><b>10.1.14</b> Legend 없애기</a></li>
<li class="chapter" data-level="10.1.15" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-16"><i class="fa fa-check"></i><b>10.1.15</b> Legend 테마 변경하기</a></li>
<li class="chapter" data-level="10.1.16" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-17"><i class="fa fa-check"></i><b>10.1.16</b> 색상 팔레트 종류</a></li>
<li class="chapter" data-level="10.1.17" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-18"><i class="fa fa-check"></i><b>10.1.17</b> 축간격 조정 하기</a></li>
<li class="chapter" data-level="10.1.18" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-19"><i class="fa fa-check"></i><b>10.1.18</b> X축 역변환 하기</a></li>
<li class="chapter" data-level="10.1.19" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-20"><i class="fa fa-check"></i><b>10.1.19</b> 축라벨에 커스터마이징</a></li>
<li class="chapter" data-level="10.1.20" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-21"><i class="fa fa-check"></i><b>10.1.20</b> 테마를 사용해서 한번에 변경</a></li>
<li class="chapter" data-level="10.1.21" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#scatter-plot"><i class="fa fa-check"></i><b>10.1.21</b> Scatter Plot(산점도)</a></li>
<li class="chapter" data-level="10.1.22" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#jitter-plot"><i class="fa fa-check"></i><b>10.1.22</b> jitter plot</a></li>
<li class="chapter" data-level="10.1.23" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#count-plot"><i class="fa fa-check"></i><b>10.1.23</b> Count Plot</a></li>
<li class="chapter" data-level="10.1.24" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-22"><i class="fa fa-check"></i><b>10.1.24</b> 가장자리 분포 그래프 추가</a></li>
<li class="chapter" data-level="10.1.25" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#correlogram"><i class="fa fa-check"></i><b>10.1.25</b> Correlogram</a></li>
<li class="chapter" data-level="10.1.26" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-23"><i class="fa fa-check"></i><b>10.1.26</b> Bar 그래프</a></li>
<li class="chapter" data-level="10.1.27" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#stacked-bar-plot---"><i class="fa fa-check"></i><b>10.1.27</b> Stacked Bar Plot (누적 막대 그래프)</a></li>
<li class="chapter" data-level="10.1.28" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#facet"><i class="fa fa-check"></i><b>10.1.28</b> Facet</a></li>
<li class="chapter" data-level="10.1.29" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-25"><i class="fa fa-check"></i><b>10.1.29</b> Position 조정</a></li>
<li class="chapter" data-level="10.1.30" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-26"><i class="fa fa-check"></i><b>10.1.30</b> Pie 차트</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-29"><i class="fa fa-check"></i><b>10.2</b> kaggle 데이터를 이용한 EDA 실습</a><ul>
<li class="chapter" data-level="10.2.1" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-30"><i class="fa fa-check"></i><b>10.2.1</b> bike sharing demand 데이터셋 설명</a></li>
<li class="chapter" data-level="10.2.2" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-31"><i class="fa fa-check"></i><b>10.2.2</b> 기본 그래프 생성</a></li>
<li class="chapter" data-level="10.2.3" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-32"><i class="fa fa-check"></i><b>10.2.3</b> ggthemr 적용하기</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-34"><i class="fa fa-check"></i><b>10.3</b> correlation 그래프 생성</a></li>
<li class="chapter" data-level="10.4" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-35"><i class="fa fa-check"></i><b>10.4</b> plot.ly 이용해서 interactive 그래프 그리기</a></li>
<li class="chapter" data-level="10.5" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-36"><i class="fa fa-check"></i><b>10.5</b> Google 지도를 이용한 지리정보 도식화</a><ul>
<li class="chapter" data-level="10.5.1" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-37"><i class="fa fa-check"></i><b>10.5.1</b> API Key 다운 받기</a></li>
<li class="chapter" data-level="10.5.2" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-38"><i class="fa fa-check"></i><b>10.5.2</b> ggmap 설치하기</a></li>
<li class="chapter" data-level="10.5.3" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-39"><i class="fa fa-check"></i><b>10.5.3</b> 서울 지도 그려보기</a></li>
<li class="chapter" data-level="10.5.4" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-40"><i class="fa fa-check"></i><b>10.5.4</b> geocode / mutate_geocode 함수를 이용해 위/경도 정보 얻기</a></li>
<li class="chapter" data-level="10.5.5" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-41"><i class="fa fa-check"></i><b>10.5.5</b> 지도를 불러서 표시 해보기</a></li>
<li class="chapter" data-level="10.5.6" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-42"><i class="fa fa-check"></i><b>10.5.6</b> map_data 를 사용한 지리정보 도식화 지리정보 도식화</a></li>
<li class="chapter" data-level="10.5.7" data-path="ggplot-visualization.html"><a href="ggplot-visualization.html#classID9-43"><i class="fa fa-check"></i><b>10.5.7</b> google map 을 사용한 지리정보 도식화</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="modeling.html"><a href="modeling.html"><i class="fa fa-check"></i><b>11</b> Modeling</a><ul>
<li class="chapter" data-level="11.1" data-path="modeling.html"><a href="modeling.html#ClassID10-1"><i class="fa fa-check"></i><b>11.1</b> Regression Model (회귀모형)</a><ul>
<li class="chapter" data-level="11.1.1" data-path="modeling.html"><a href="modeling.html#ClassID10-2"><i class="fa fa-check"></i><b>11.1.1</b> Univariate Linear Regression (단변량 선형회기모형)</a></li>
<li class="chapter" data-level="11.1.2" data-path="modeling.html"><a href="modeling.html#ClassID10-3"><i class="fa fa-check"></i><b>11.1.2</b> Multivariate Linear Regression (다변량 선형회기모형)</a></li>
<li class="chapter" data-level="11.1.3" data-path="modeling.html"><a href="modeling.html#ClassID10-4"><i class="fa fa-check"></i><b>11.1.3</b> Polynomial Regression (다항 선형회기모형)</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="modeling.html"><a href="modeling.html#ClassID10-9"><i class="fa fa-check"></i><b>11.2</b> Classification Model (분류모형)</a><ul>
<li class="chapter" data-level="11.2.1" data-path="modeling.html"><a href="modeling.html#ClassID10-10"><i class="fa fa-check"></i><b>11.2.1</b> Logistic Regression</a></li>
<li class="chapter" data-level="11.2.2" data-path="modeling.html"><a href="modeling.html#ClassID10-17"><i class="fa fa-check"></i><b>11.2.2</b> K-Nearest Neighbors(K-NN)</a></li>
<li class="chapter" data-level="11.2.3" data-path="modeling.html"><a href="modeling.html#ClassID10-25"><i class="fa fa-check"></i><b>11.2.3</b> Support Vector Machine(SVM)</a></li>
<li class="chapter" data-level="11.2.4" data-path="modeling.html"><a href="modeling.html#ClassID10-32"><i class="fa fa-check"></i><b>11.2.4</b> Decision Tree Classification</a></li>
<li class="chapter" data-level="11.2.5" data-path="modeling.html"><a href="modeling.html#ClassID10-36"><i class="fa fa-check"></i><b>11.2.5</b> Random Forrest Classfication</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="modeling.html"><a href="modeling.html#ClassID10-40"><i class="fa fa-check"></i><b>11.3</b> Clustering 군집 모델</a><ul>
<li class="chapter" data-level="11.3.1" data-path="modeling.html"><a href="modeling.html#ClassID10-41"><i class="fa fa-check"></i><b>11.3.1</b> K-Means Clustering</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="modeling-part-2.html"><a href="modeling-part-2.html"><i class="fa fa-check"></i><b>12</b> Modeling Part 2</a></li>
<li class="divider"></li>
<li><a href="https://github.com/dangtong76" target="blank">Dangtong R</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">BigData with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling" class="section level1">
<h1><span class="header-section-number">Chapter 11</span> Modeling</h1>
<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('left', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="ClassID10-1" class="section level2">
<h2><span class="header-section-number">11.1</span> Regression Model (회귀모형)</h2>
<div id="ClassID10-2" class="section level3">
<h3><span class="header-section-number">11.1.1</span> Univariate Linear Regression (단변량 선형회기모형)</h3>
<ul>
<li><p>변수가 하나일때의 선형회귀를 단변량 선형 회귀 라고 합니다.</p></li>
<li><p>데이터을 가져오고 , 훈련데이터 및 테스트 데이터로 분할</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Univariate Linear Regression (단변량 선형회기모형)</span>
<span class="kw">library</span>(tidyverse)


<span class="co"># 데이터셋 읽기</span>
dataset =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;Salary_Data.csv&#39;</span>)

<span class="co"># 데이터셋을 Training set 과 Test set 으로 분할 합니다.</span>
<span class="co"># install.packages(&#39;caTools&#39;)</span>
<span class="kw">library</span>(caTools)
<span class="kw">set.seed</span>(<span class="dv">123</span>)
split =<span class="st"> </span><span class="kw">sample.split</span>(dataset<span class="op">$</span>Salary, <span class="dt">SplitRatio =</span> <span class="dv">2</span><span class="op">/</span><span class="dv">3</span>)
training_set =<span class="st"> </span><span class="kw">subset</span>(dataset, split <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)
test_set =<span class="st"> </span><span class="kw">subset</span>(dataset, split <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>)</code></pre></div>
<ul>
<li>feature 스케일링 및 모델 핏팅</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Feature 스케일링</span>
<span class="co"># training_set = scale(training_set)</span>
<span class="co"># test_set = scale(test_set)</span>

<span class="co"># Training 데이터를 단변량 선형회기 함수에 핏팅 합니다.</span>
regressor =<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> Salary <span class="op">~</span><span class="st"> </span>YearsExperience,
               <span class="dt">data =</span> training_set)</code></pre></div>
<ul>
<li>모델에 대한 정보를 보기 위해 summary 함수를 호출하면 모델에 대한 다양한 통계 정보를 확인 할수 있습니다.</li>
</ul>
<table>
<thead>
<tr class="header">
<th>항목</th>
<th>설명</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Residuals(잔차)</td>
<td>예측과 실측 사이의 잔차에 대한 분포를 보여 줍니다</td>
</tr>
<tr class="even">
<td>Coefficients(계수)</td>
<td>각각의 변수에 대한 P value 정보를 보여 줍니다. * 가 많으면 통계적으로 유의</td>
</tr>
<tr class="odd">
<td>Signif</td>
<td>P Value 에 따른 Significant Levle 구간을 표시 합니다.</td>
</tr>
<tr class="even">
<td>R-Squard</td>
<td>만들어진 모델이 얼마나 데이터를 잘 설명하는지를 보여주는 지표</td>
</tr>
</tbody>
</table>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(regressor)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Salary ~ YearsExperience, data = training_set)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -7325.1 -3814.4   427.7  3559.7  8884.6 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        25592       2646   9.672 1.49e-08 ***
## YearsExperience     9365        421  22.245 1.52e-14 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 5391 on 18 degrees of freedom
## Multiple R-squared:  0.9649, Adjusted R-squared:  0.963 
## F-statistic: 494.8 on 1 and 18 DF,  p-value: 1.524e-14</code></pre>
<ul>
<li>테스트 데이터를 모델에 넣어서 scoring 수행</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y_pred =<span class="st"> </span><span class="kw">predict</span>(regressor, <span class="dt">newdata =</span> test_set)
y_pred</code></pre></div>
<pre><code>##         1         2         3         4         5         6         7 
##  37766.77  44322.33  46195.35  55560.43  62115.99  71481.07  81782.66 
##         8         9        10 
##  89274.72 102385.84 109877.90</code></pre>
<ul>
<li>훈련 데이터 데이터에 대해 모델 그려보기</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> training_set<span class="op">$</span>YearsExperience, <span class="dt">y =</span> training_set<span class="op">$</span>Salary),
             <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> training_set<span class="op">$</span>YearsExperience, <span class="dt">y =</span> <span class="kw">predict</span>(regressor, <span class="dt">newdata =</span> training_set)),
            <span class="dt">colour =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&#39;Salary vs Experience (Training set)&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&#39;Years of experience&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Salary&#39;</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<ul>
<li>테스트 데이터에 대해 모델 그려보기</li>
<li>산점도(데이터)는 test_set 으로 선그래프(model)는 training_set 으로 그립니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 테스트 데이터에 대해 모델 그려보기</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> test_set<span class="op">$</span>YearsExperience, <span class="dt">y =</span> test_set<span class="op">$</span>Salary),
             <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> training_set<span class="op">$</span>YearsExperience, <span class="dt">y =</span> <span class="kw">predict</span>(regressor, <span class="dt">newdata =</span> training_set)),
            <span class="dt">colour =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&#39;Salary vs Experience (Test set)&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&#39;Years of experience&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Salary&#39;</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
</div>
<div id="ClassID10-3" class="section level3">
<h3><span class="header-section-number">11.1.2</span> Multivariate Linear Regression (다변량 선형회기모형)</h3>
<ul>
<li>여러개의 X 변수에 대한 회귀를 다변량 선형 회귀 라고 합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Multivariate Linear Regression (다변량 선형회기모형)</span>

<span class="co"># 데이터셋 읽기</span>
<span class="kw">library</span>(tidyverse)
dataset =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;50_Startups.csv&#39;</span>)

<span class="co"># 범주형 데이터에 대해 원핫인코딩 합니다.</span>
dataset<span class="op">$</span>State =<span class="st"> </span><span class="kw">factor</span>(dataset<span class="op">$</span>State,
                       <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&#39;New York&#39;</span>, <span class="st">&#39;California&#39;</span>, <span class="st">&#39;Florida&#39;</span>),
                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>))

<span class="co"># 데이터셋을 Training set 과 Test set 으로 분할 합니다.</span>
<span class="co"># install.packages(&#39;caTools&#39;)</span>
<span class="kw">library</span>(caTools)
<span class="kw">set.seed</span>(<span class="dv">123</span>)
split =<span class="st"> </span><span class="kw">sample.split</span>(dataset<span class="op">$</span>Profit, <span class="dt">SplitRatio =</span> <span class="fl">0.8</span>)
training_set =<span class="st"> </span><span class="kw">subset</span>(dataset, split <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)
test_set =<span class="st"> </span><span class="kw">subset</span>(dataset, split <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>)

<span class="co"># Feature 스케일링</span>
<span class="co"># training_set = scale(training_set)</span>
<span class="co"># test_set = scale(test_set)</span>

<span class="co"># 훈련 데이터를 다변량 회귀에 핏팅 합니다.</span>
regressor =<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> Profit <span class="op">~</span><span class="st"> </span>.,
               <span class="dt">data =</span> training_set)

<span class="kw">summary</span>(regressor)</code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Profit ~ ., data = training_set)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -33128  -4865      5   6098  18065 
## 
## Coefficients:
##                     Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)        4.965e+04  7.637e+03   6.501 1.94e-07 ***
## `R&amp;D Spend`        7.986e-01  5.604e-02  14.251 6.70e-16 ***
## Administration    -2.942e-02  5.828e-02  -0.505    0.617    
## `Marketing Spend`  3.268e-02  2.127e-02   1.537    0.134    
## State2             1.213e+02  3.751e+03   0.032    0.974    
## State3             2.376e+02  4.127e+03   0.058    0.954    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 9908 on 34 degrees of freedom
## Multiple R-squared:  0.9499, Adjusted R-squared:  0.9425 
## F-statistic:   129 on 5 and 34 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 만들어진 모델을 이용해 테스트 데이터에 대해 스코어링 수행</span>
y_pred =<span class="st"> </span><span class="kw">predict</span>(regressor, <span class="dt">newdata =</span> test_set)

y_pred</code></pre></div>
<pre><code>##         1         2         3         4         5         6         7 
## 173981.09 172655.64 160250.02 135513.90 146059.36 114151.03 117081.62 
##         8         9        10 
## 110671.31  98975.29  96867.03</code></pre>
</div>
<div id="ClassID10-4" class="section level3">
<h3><span class="header-section-number">11.1.3</span> Polynomial Regression (다항 선형회기모형)</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Polynomial Regression (다항 선형회기모형)</span>

<span class="co"># 데이터 읽기</span>
dataset =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;Position_Salaries.csv&#39;</span>)
dataset</code></pre></div>
<pre><code>##             Position Level  Salary
## 1   Business Analyst     1   45000
## 2  Junior Consultant     2   50000
## 3  Senior Consultant     3   60000
## 4            Manager     4   80000
## 5    Country Manager     5  110000
## 6     Region Manager     6  150000
## 7            Partner     7  200000
## 8     Senior Partner     8  300000
## 9            C-level     9  500000
## 10               CEO    10 1000000</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset =<span class="st"> </span>dataset[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>] 

<span class="co"># Splitting the dataset into the Training set and Test set</span>
<span class="co"># # install.packages(&#39;caTools&#39;)</span>
<span class="co"># library(caTools)</span>
<span class="co"># set.seed(123)</span>
<span class="co"># split = sample.split(dataset$Salary, SplitRatio = 2/3)</span>
<span class="co"># training_set = subset(dataset, split == TRUE)</span>
<span class="co"># test_set = subset(dataset, split == FALSE)</span>

<span class="co"># Feature Scaling</span>
<span class="co"># training_set = scale(training_set)</span>
<span class="co"># test_set = scale(test_set)</span>

<span class="co"># Fitting Linear Regression to the dataset</span>
lin_reg =<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> Salary <span class="op">~</span><span class="st"> </span>.,
             <span class="dt">data =</span> dataset)

<span class="co"># Fitting Polynomial Regression to the dataset</span>
dataset<span class="op">$</span>Level2 =<span class="st"> </span>dataset<span class="op">$</span>Level<span class="op">^</span><span class="dv">2</span>
dataset<span class="op">$</span>Level3 =<span class="st"> </span>dataset<span class="op">$</span>Level<span class="op">^</span><span class="dv">3</span>
dataset<span class="op">$</span>Level4 =<span class="st"> </span>dataset<span class="op">$</span>Level<span class="op">^</span><span class="dv">4</span>
poly_reg =<span class="st"> </span><span class="kw">lm</span>(<span class="dt">formula =</span> Salary <span class="op">~</span><span class="st"> </span>.,
              <span class="dt">data =</span> dataset)

<span class="co"># Visualising the Linear Regression results</span>
<span class="co"># install.packages(&#39;ggplot2&#39;)</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dataset<span class="op">$</span>Level, <span class="dt">y =</span> dataset<span class="op">$</span>Salary),
             <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dataset<span class="op">$</span>Level, <span class="dt">y =</span> <span class="kw">predict</span>(lin_reg, <span class="dt">newdata =</span> dataset)),
            <span class="dt">colour =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&#39;Truth or Bluff (Linear Regression)&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&#39;Level&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Salary&#39;</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Visualising the Polynomial Regression results</span>
<span class="co"># install.packages(&#39;ggplot2&#39;)</span>
<span class="kw">library</span>(ggplot2)
<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dataset<span class="op">$</span>Level, <span class="dt">y =</span> dataset<span class="op">$</span>Salary),
             <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dataset<span class="op">$</span>Level, <span class="dt">y =</span> <span class="kw">predict</span>(poly_reg, <span class="dt">newdata =</span> dataset)),
            <span class="dt">colour =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&#39;Truth or Bluff (Polynomial Regression)&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&#39;Level&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Salary&#39;</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-10-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Visualising the Regression Model results (for higher resolution and smoother curve)</span>
<span class="co"># install.packages(&#39;ggplot2&#39;)</span>
<span class="kw">library</span>(ggplot2)
x_grid =<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(dataset<span class="op">$</span>Level), <span class="kw">max</span>(dataset<span class="op">$</span>Level), <span class="fl">0.1</span>)
<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> dataset<span class="op">$</span>Level, <span class="dt">y =</span> dataset<span class="op">$</span>Salary),
             <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x_grid, <span class="dt">y =</span> <span class="kw">predict</span>(poly_reg,
                                        <span class="dt">newdata =</span> <span class="kw">data.frame</span>(<span class="dt">Level =</span> x_grid,
                                                             <span class="dt">Level2 =</span> x_grid<span class="op">^</span><span class="dv">2</span>,
                                                             <span class="dt">Level3 =</span> x_grid<span class="op">^</span><span class="dv">3</span>,
                                                             <span class="dt">Level4 =</span> x_grid<span class="op">^</span><span class="dv">4</span>))),
            <span class="dt">colour =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&#39;Truth or Bluff (Polynomial Regression)&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&#39;Level&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&#39;Salary&#39;</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-10-3.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Predicting a new result with Linear Regression</span>
<span class="kw">predict</span>(lin_reg, <span class="kw">data.frame</span>(<span class="dt">Level =</span> <span class="fl">6.5</span>))</code></pre></div>
<pre><code>##        1 
## 330378.8</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Predicting a new result with Polynomial Regression</span>
<span class="kw">predict</span>(poly_reg, <span class="kw">data.frame</span>(<span class="dt">Level =</span> <span class="fl">6.5</span>,
                             <span class="dt">Level2 =</span> <span class="fl">6.5</span><span class="op">^</span><span class="dv">2</span>,
                             <span class="dt">Level3 =</span> <span class="fl">6.5</span><span class="op">^</span><span class="dv">3</span>,
                             <span class="dt">Level4 =</span> <span class="fl">6.5</span><span class="op">^</span><span class="dv">4</span>))</code></pre></div>
<pre><code>##        1 
## 158862.5</code></pre>
</div>
</div>
<div id="ClassID10-9" class="section level2">
<h2><span class="header-section-number">11.2</span> Classification Model (분류모형)</h2>
<div id="ClassID10-10" class="section level3">
<h3><span class="header-section-number">11.2.1</span> Logistic Regression</h3>
<ul>
<li><p>Logistic Regression 실습에서는 <a href="https://www.kaggle.com/c/titanic">Kagge 타이타닉 데이터</a> 로 모델 실습을 하겠습니다. 승객 들의 여러가지 정보를 바탕으로 Logistic Regression 을 바탕으로 생존 예측을 해보도록 하겠습니다.</p></li>
<li><p>데이터 불러오기</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
df.train &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;titanic_train.csv&#39;</span>)</code></pre></div>
<div id="ClassID10-11" class="section level4">
<h4><span class="header-section-number">11.2.1.1</span> Amelia 패키지를 이용한 결측치 시각화</h4>
<p>현재 타이타닉 데이터 셋의 age(나이) 컬럼은 NA 값이 존재 합니다. 얼마나 존재 하는 지 확인하기 위해 Amelias 패키지를 통해 NA 값을 시각화 합니다.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># is.na(df.train) # is.na 합수는 전체 데이터에 대해 TRUE FALSE 로 보여 주기 때문에 한번에 알아보기가 힘듭니다.</span>

<span class="co"># install.packages(&quot;Amelia&quot;)</span>
<span class="kw">library</span>(Amelia)
<span class="kw">missmap</span>(df.train, <span class="dt">main=</span><span class="st">&quot;Titanic Training Data - NA&quot;</span>, 
        <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;black&quot;</span>), <span class="dt">legend=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<ul>
<li>Cabin(선실), Age(나이) 값들에 NA 가 존재 합니다. Age 데이터의 경우 약 20% 정도가 결측(NA) 가 있습니다. 일단 NA 값이 어떠한 분포로 얼마나 많이 있는지 시각화를 했습니다. 이후 과정에서 결측(NA)치 를 처리 할 것입니다.</li>
</ul>
</div>
<div id="ClassID10-12" class="section level4">
<h4><span class="header-section-number">11.2.1.2</span> ggplot2 를 이용한 데이터 시각화</h4>
<ul>
<li>생존/사망의 비율을 시각화 해봅니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df.train,<span class="kw">aes</span>(Survived)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<ul>
<li>승객 Pclass(등급) 별로 몇명이 있는지 확인 해봅니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Pclass)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill=</span><span class="kw">factor</span>(Pclass)),<span class="dt">alpha=</span><span class="fl">0.5</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<ul>
<li>승객의 성(Sex) 비율이 어덯게 되는지 봅니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Sex)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill=</span><span class="kw">factor</span>(Sex)),<span class="dt">alpha=</span><span class="fl">0.5</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<ul>
<li></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Age)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">fill=</span><span class="st">&#39;blue&#39;</span>,<span class="dt">bins=</span><span class="dv">20</span>,<span class="dt">alpha=</span><span class="fl">0.5</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<ul>
<li>SibSp(동승자)가 몇명이나 되는지 확인 합시다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Fare)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">fill=</span><span class="st">&#39;green&#39;</span>,<span class="dt">color=</span><span class="st">&#39;black&#39;</span>,<span class="dt">alpha=</span><span class="fl">0.5</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
<div id="ClassID10-13" class="section level4">
<h4><span class="header-section-number">11.2.1.3</span> 데이터 클린징</h4>
<ul>
<li>앞서 age 데이터에 결측(NA) 값이 20% 정도 발견이 되었습니다.</li>
<li>직관적으로 승객의 나이가 생존 여부와 상관이 있을것 같기 때문에 age 변수를 없애거나 입의이 값으로 대체 해야 합니다.</li>
<li>결측된 age 컬럼을 가진 관측치를 없애기에는 데이터가 조금(20%) 많습니다.</li>
<li>Age 값을 전체 데이터의 평균 값으로 넣어도 되지만, 좀더 모델을 성능을 높이기 위해 Age 와 상관 있는 변수가 무엇인지 고민해 보면 Pclass(승객등급) 별로 나이가 다를 것 같습니다. 일단 그려 봅니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(Pclass,Age)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">group=</span>Pclass,<span class="dt">fill=</span><span class="kw">factor</span>(Pclass),<span class="dt">alpha=</span><span class="fl">0.4</span>))  <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="kw">min</span>(<span class="dv">0</span>), <span class="kw">max</span>(<span class="dv">80</span>), <span class="dt">by =</span> <span class="dv">2</span>))</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<ul>
<li>그래프를 확인해보면 객실 등급별로 전체 적인 평균 나이가 차이가 납니다.</li>
<li><p>Age(나이)에 대한 결측치를 Pclass(승객등급) 의 평균 나이로 설정하면 좀더 정확한 모델을 만들수 있습니다.</p></li>
<li>아래 함수는 결측치가 있을 경우 해당하는 사람의 승객등급을 확인하고 앞서 확인한 승객 등급별 평균 나이를 반환하는 함수 입니다.</li>
<li></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">returunPclassAge &lt;-<span class="st"> </span><span class="cf">function</span>(age,class){
    out &lt;-<span class="st"> </span>age
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(age)){
        
        <span class="cf">if</span> (<span class="kw">is.na</span>(age[i])){

            <span class="cf">if</span> (class[i] <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){
                out[i] &lt;-<span class="st"> </span><span class="dv">37</span>

            }<span class="cf">else</span> <span class="cf">if</span> (class[i] <span class="op">==</span><span class="st"> </span><span class="dv">2</span>){
                out[i] &lt;-<span class="st"> </span><span class="dv">29</span>

            }<span class="cf">else</span>{
                out[i] &lt;-<span class="st"> </span><span class="dv">24</span>
            }
        }<span class="cf">else</span>{
            out[i]&lt;-age[i]
        }
    }
    <span class="kw">return</span>(out)
}</code></pre></div>
<ul>
<li></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.train &lt;-<span class="st"> </span>df.train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Age =</span> <span class="kw">returunPclassAge</span>(Age, Pclass))</code></pre></div>
<ul>
<li>다시 Amelia 패키지의 missmap 한수를 돌려 결측치를 확인합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">missmap</span>(df.train, <span class="dt">main=</span><span class="st">&quot;Titanic Training Data - NA&quot;</span>, 
        <span class="dt">col=</span><span class="kw">c</span>(<span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;black&quot;</span>), <span class="dt">legend=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<ul>
<li>Age 변수의 결측(NA) 들을 Pclass(승객등급) 별 평균 나이로 설정 하여 결측치를 제거 하였습니다.</li>
</ul>
</div>
<div id="ClassID10-14" class="section level4">
<h4><span class="header-section-number">11.2.1.4</span> 모델 학습을 위한 데이터 전처리</h4>
<ul>
<li>불필요한 변수를 제거 합니다. 물론, 제거 하지 않고 p value 를 확인해서 나중에 fitting 과정에서 제거 해도 됩니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(df.train)</code></pre></div>
<pre><code>## Classes &#39;spec_tbl_df&#39;, &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 891 obs. of  12 variables:
##  $ PassengerId: num  1 2 3 4 5 6 7 8 9 10 ...
##  $ Survived   : num  0 1 1 1 0 0 0 0 1 1 ...
##  $ Pclass     : num  3 1 3 1 3 3 1 3 3 2 ...
##  $ Name       : chr  &quot;Braund, Mr. Owen Harris&quot; &quot;Cumings, Mrs. John Bradley (Florence Briggs Thayer)&quot; &quot;Heikkinen, Miss. Laina&quot; &quot;Futrelle, Mrs. Jacques Heath (Lily May Peel)&quot; ...
##  $ Sex        : chr  &quot;male&quot; &quot;female&quot; &quot;female&quot; &quot;female&quot; ...
##  $ Age        : num  22 38 26 35 35 24 54 2 27 14 ...
##  $ SibSp      : num  1 1 0 1 0 0 0 3 0 1 ...
##  $ Parch      : num  0 0 0 0 0 0 0 1 2 0 ...
##  $ Ticket     : chr  &quot;A/5 21171&quot; &quot;PC 17599&quot; &quot;STON/O2. 3101282&quot; &quot;113803&quot; ...
##  $ Fare       : num  7.25 71.28 7.92 53.1 8.05 ...
##  $ Cabin      : chr  NA &quot;C85&quot; NA &quot;C123&quot; ...
##  $ Embarked   : chr  &quot;S&quot; &quot;C&quot; &quot;S&quot; &quot;S&quot; ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df.train,<span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 12
##   PassengerId Survived Pclass Name  Sex     Age SibSp Parch Ticket  Fare
##         &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1           1        0      3 Brau… male     22     1     0 A/5 2…  7.25
## 2           2        1      1 Cumi… fema…    38     1     0 PC 17… 71.3 
## 3           3        1      3 Heik… fema…    26     0     0 STON/…  7.92
## # … with 2 more variables: Cabin &lt;chr&gt;, Embarked &lt;chr&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 데이터 셋에서 PassengerId, Name, Ticket, Cabin 컬럼을 제거 합니다.</span>
df.train &lt;-<span class="st"> </span>df.train <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>PassengerId,<span class="op">-</span>Name,<span class="op">-</span>Ticket,<span class="op">-</span>Cabin)
<span class="kw">head</span>(df.train,<span class="dv">3</span>)</code></pre></div>
<pre><code>## # A tibble: 3 x 8
##   Survived Pclass Sex      Age SibSp Parch  Fare Embarked
##      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   
## 1        0      3 male      22     1     0  7.25 S       
## 2        1      1 female    38     1     0 71.3  C       
## 3        1      3 female    26     0     0  7.92 S</code></pre>
<ul>
<li>문자현 변수들에 대해 범주형으로 바꿔 줍니다. 범주형 변수(Factor) 로 바꿔주면 Level이 생기고 나중에 Pvalue 값를 확인할때 Level 에 대한 Pvalue 를 자동으로 만들어 줍니다.</li>
<li>Survived, Pclass, Parch, SibSp 문자형 변수에 대해 Factor 로 변환 합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(df.train)</code></pre></div>
<pre><code>## Classes &#39;spec_tbl_df&#39;, &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;: 891 obs. of  8 variables:
##  $ Survived: num  0 1 1 1 0 0 0 0 1 1 ...
##  $ Pclass  : num  3 1 3 1 3 3 1 3 3 2 ...
##  $ Sex     : chr  &quot;male&quot; &quot;female&quot; &quot;female&quot; &quot;female&quot; ...
##  $ Age     : num  22 38 26 35 35 24 54 2 27 14 ...
##  $ SibSp   : num  1 1 0 1 0 0 0 3 0 1 ...
##  $ Parch   : num  0 0 0 0 0 0 0 1 2 0 ...
##  $ Fare    : num  7.25 71.28 7.92 53.1 8.05 ...
##  $ Embarked: chr  &quot;S&quot; &quot;C&quot; &quot;S&quot; &quot;S&quot; ...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.train<span class="op">$</span>Survived &lt;-<span class="st"> </span><span class="kw">factor</span>(df.train<span class="op">$</span>Survived)
df.train<span class="op">$</span>Pclass &lt;-<span class="st"> </span><span class="kw">factor</span>(df.train<span class="op">$</span>Pclass)
df.train<span class="op">$</span>Parch &lt;-<span class="st"> </span><span class="kw">factor</span>(df.train<span class="op">$</span>Parch)
df.train<span class="op">$</span>SibSp &lt;-<span class="st"> </span><span class="kw">factor</span>(df.train<span class="op">$</span>SibSp)</code></pre></div>
</div>
<div id="ClassID10-15" class="section level4">
<h4><span class="header-section-number">11.2.1.5</span> 훈련데이터와 테스트 데이터 나누기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caTools)
<span class="kw">set.seed</span>(<span class="dv">101</span>)

split =<span class="st"> </span><span class="kw">sample.split</span>(df.train<span class="op">$</span>Survived, <span class="dt">SplitRatio =</span> <span class="fl">0.70</span>)

final.train =<span class="st"> </span><span class="kw">subset</span>(df.train, split <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)
final.test =<span class="st"> </span><span class="kw">subset</span>(df.train, split <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">final.log.model1 &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula=</span>Survived <span class="op">~</span><span class="st"> </span>. , <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&#39;logit&#39;</span>),<span class="dt">data =</span> final.train)
<span class="kw">summary</span>(final.log.model1)</code></pre></div>
<pre><code>## 
## Call:
## glm(formula = Survived ~ ., family = binomial(link = &quot;logit&quot;), 
##     data = final.train)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.8315  -0.5604  -0.4093   0.6175   2.4904  
## 
## Coefficients:
##               Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  3.804e+00  6.208e-01   6.128 8.89e-10 ***
## Pclass2     -1.236e+00  3.812e-01  -3.243 0.001183 ** 
## Pclass3     -2.166e+00  3.839e-01  -5.642 1.68e-08 ***
## Sexmale     -2.666e+00  2.465e-01 -10.814  &lt; 2e-16 ***
## Age         -3.836e-02  1.035e-02  -3.708 0.000209 ***
## SibSp1      -2.380e-02  2.756e-01  -0.086 0.931185    
## SibSp2      -4.016e-01  6.466e-01  -0.621 0.534536    
## SibSp3      -2.329e+00  9.000e-01  -2.588 0.009649 ** 
## SibSp4      -1.196e+00  8.305e-01  -1.440 0.149805    
## SibSp5      -1.603e+01  9.589e+02  -0.017 0.986662    
## SibSp8      -1.633e+01  1.003e+03  -0.016 0.987012    
## Parch1       7.287e-01  3.548e-01   2.054 0.040007 *  
## Parch2       1.368e-01  4.506e-01   0.304 0.761476    
## Parch3       7.904e-01  1.229e+00   0.643 0.520061    
## Parch4      -1.498e+01  1.551e+03  -0.010 0.992294    
## Parch5      -1.221e-02  1.379e+00  -0.009 0.992935    
## Parch6      -1.635e+01  2.400e+03  -0.007 0.994563    
## Fare         3.145e-03  3.097e-03   1.015 0.309957    
## EmbarkedQ    1.019e-01  4.509e-01   0.226 0.821153    
## EmbarkedS   -3.269e-01  2.905e-01  -1.125 0.260600    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 829.60  on 622  degrees of freedom
## Residual deviance: 530.82  on 603  degrees of freedom
## AIC: 570.82
## 
## Number of Fisher Scoring iterations: 15</code></pre>
<ul>
<li>테스트 데이터로 스코어링 수행</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fitted.probabilities1 &lt;-<span class="st"> </span><span class="kw">predict</span>(final.log.model1,<span class="dt">newdata=</span>final.test,<span class="dt">type=</span><span class="st">&#39;response&#39;</span>)</code></pre></div>
<ul>
<li>스코어링 결과에서 0.5 가 넘는 것(생존)은 1, 0.5 이하(사망)은 0 으로</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fitted.results1 &lt;-<span class="st"> </span><span class="kw">ifelse</span>(fitted.probabilities1 <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">0</span>)</code></pre></div>
<ul>
<li>스코어링 결과 와 테스트 데이터의 라벨을 비교해서 <strong>오분류율</strong>을 구하고 1에서 오분류 율을 빼서 <strong>정답율</strong> 을 구합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">misClasificError &lt;-<span class="st"> </span><span class="kw">mean</span>(fitted.results1 <span class="op">!=</span><span class="st"> </span>final.test<span class="op">$</span>Survived)


<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&#39;Accuracy&#39;</span>,<span class="dv">1</span><span class="op">-</span>misClasificError))</code></pre></div>
<pre><code>## [1] &quot;Accuracy 0.798507462686567&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(final.test<span class="op">$</span>Survived, fitted.probabilities1 <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span>)</code></pre></div>
<pre><code>##    
##     FALSE TRUE
##   0   140   25
##   1    29   74</code></pre>
</div>
<div id="ClassID10-16" class="section level4">
<h4><span class="header-section-number">11.2.1.6</span> 모델 평가</h4>
<ul>
<li>모델평가를 테스트로 하기 휘해서 Logistic Regression 에서 특정 변수만 넣어서서 모델을 하나 더 만들고 기존 모델과 성능을 평가해 보도록 하겠습니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;ROCR&quot;)</span>
<span class="kw">library</span>(ROCR) <span class="co"># ROC 커브를 그리기 위한 패키지</span>
<span class="co"># 두번째 모델을 훈련 시킵니다.</span>
final.log.model2 &lt;-<span class="st"> </span><span class="kw">glm</span>(<span class="dt">formula=</span>Survived <span class="op">~</span><span class="st"> </span>Pclass  <span class="op">+</span><span class="st"> </span>Fare  , <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link=</span><span class="st">&#39;logit&#39;</span>),<span class="dt">data =</span> final.train)
<span class="co"># 테스트 데이터로 동일하게 스코어링 수행</span>
fitted.probabilities2 &lt;-<span class="st"> </span><span class="kw">predict</span>(final.log.model2,<span class="dt">newdata=</span>final.test,<span class="dt">type=</span><span class="st">&#39;response&#39;</span>)</code></pre></div>
<ul>
<li>이제부터는 prediction 함수를 이용해서 라벨(정답) 값에 대한 예측정확도를 구합니다.</li>
<li>첫번째 모델과 두번째 모델을 모두 구합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">predict1 &lt;-<span class="st"> </span><span class="kw">prediction</span>(fitted.probabilities1 , final.test<span class="op">$</span>Survived )
predict2 &lt;-<span class="st"> </span><span class="kw">prediction</span>(fitted.probabilities2 , final.test<span class="op">$</span>Survived )</code></pre></div>
<ul>
<li>정확도를 이용해서 Performance 함수를 이용해서 모델의 성능을 구합니다. 여기서 말하는 성능은 Confusion Matrix 에서 TPR(민감도) FPR(특이도) 을 반환 합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 첫번째 모델에 대한 ROC 커브를 그립니다. </span>

perf1 &lt;-<span class="st"> </span><span class="kw">performance</span>(predict1, <span class="st">&quot;tpr&quot;</span>, <span class="st">&quot;fpr&quot;</span>) 
perf2 &lt;-<span class="st"> </span><span class="kw">performance</span>(predict2, <span class="st">&quot;tpr&quot;</span>, <span class="st">&quot;fpr&quot;</span>) 

<span class="co"># 2개의 ROC 곡선을 하나의 차트에 그립니다.</span>
<span class="kw">plot</span>(perf1, <span class="dt">col=</span><span class="dv">1</span>) 
<span class="kw">par</span>(<span class="dt">new=</span>T) <span class="co"># 첫번째 차트에 추가 해도됨.(같이 겹쳐그리기 위해)</span>
<span class="kw">plot</span>(perf2, <span class="dt">col=</span><span class="dv">2</span>) 
<span class="kw">legend</span>(<span class="fl">0.6</span>,<span class="fl">0.6</span>, <span class="kw">c</span>(<span class="st">&quot;model1&quot;</span>, <span class="st">&quot;model2&quot;</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<ul>
<li>실제 model 2 오분류 율을 확인해 봅니다.</li>
</ul>
</div>
</div>
<div id="ClassID10-17" class="section level3">
<h3><span class="header-section-number">11.2.2</span> K-Nearest Neighbors(K-NN)</h3>
<ul>
<li>KNN 을 적용하여 수집된 정보를 바탕으로 고객이 Caraban 을 살것인지 말것인지를 예측하는 실습 을 해보겠습니다.</li>
</ul>
<div id="ClassID10-18" class="section level4">
<h4><span class="header-section-number">11.2.2.1</span> 데이터 다운로드</h4>
<ul>
<li>데이터는 ISLR 패키지에 있습니다. 설치 하고 library 함수를 이용해 불러옵니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&#39;ISLR&#39;</span>,<span class="dt">repos =</span> <span class="st">&#39;http://cran.us.r-project.org&#39;</span>)</code></pre></div>
<pre><code>## 
## The downloaded binary packages are in
##  /var/folders/qx/j_2_gqz94yg0nsdycn8_rtlm0000gn/T//RtmpmwkpDh/downloaded_packages</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ISLR)</code></pre></div>
</div>
<div id="ClassID10-19" class="section level4">
<h4><span class="header-section-number">11.2.2.2</span> 데이터 정규화(Scaling)</h4>
<ul>
<li>KNN 은 가까운 이웃간의 공간 거리로 분류를 하는 모델이기 때문에 데이터 표준화가 매우 중요합니다.</li>
<li>첫번째, 두번째 데이터의 분포(Variance) 를 확인해보면 차이가 큽니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 첫번때 Feature 와 두번째 Feature 의 데이터 분포를 확인 합니다.</span>
<span class="kw">var</span>(Caravan[,<span class="dv">1</span>]) <span class="co"># 데이터 분포(Variance) 를 확인합니다.</span></code></pre></div>
<pre><code>## [1] 165.0378</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">var</span>(Caravan[,<span class="dv">2</span>]) <span class="co"># 데이터 분포(Variance) 를 확인합니다.</span></code></pre></div>
<pre><code>## [1] 0.1647078</code></pre>
<ul>
<li>레이블(정답) 데이터를 제외함 모든 데이터에 대해 정규화를 수행합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 레이블 컬럼을 따로 저장 해둡니다.</span>
stdCaraban &lt;-<span class="st"> </span>Caravan <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>Purchase), scale)
<span class="kw">var</span>(stdCaraban[,<span class="dv">1</span>])</code></pre></div>
<pre><code>##      [,1]
## [1,]    1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">var</span>(stdCaraban[,<span class="dv">2</span>])</code></pre></div>
<pre><code>##      [,1]
## [1,]    1</code></pre>
</div>
<div id="ClassID10-20" class="section level4">
<h4><span class="header-section-number">11.2.2.3</span> 훈련데이터와 테스트 데이터 나누기</h4>
<ul>
<li>knn 모델 함수는 인자로 훈련데이터, 테스트 데이터, 훈련데이터 레이블 을 받습니다.</li>
<li>일반적인 머신러닝 함수들은 훈련데이터에 레이블을 포함해서 받지만, knn 함수는 따로 분리해서 인자를 받기 때문에 <strong>데이터셋을 나룰때 레이블도 같이 나누어 주어야</strong> 합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caTools)
<span class="kw">set.seed</span>(<span class="dv">101</span>)

split =<span class="st"> </span><span class="kw">sample.split</span>(stdCaraban<span class="op">$</span>Purchase, <span class="dt">SplitRatio =</span> <span class="fl">0.70</span>)


knn.train.data &lt;-<span class="st">  </span><span class="kw">subset</span>(stdCaraban, split <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)  <span class="co"># 훈련데이터  수집</span>
knn.train.purchase &lt;-<span class="st"> </span>knn.train.data<span class="op">$</span>Purchase    <span class="co"># 훈련데이터 레이블 따로 저장</span>
knn.train.data &lt;-<span class="st"> </span>knn.train.data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select_at</span>(<span class="kw">vars</span>(<span class="op">-</span>Purchase)) <span class="co"># 훈련데이터 에서 레이블 제거</span>


knn.test.data &lt;-<span class="st">  </span><span class="kw">subset</span>(stdCaraban, split <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>)  <span class="co"># 테스트데이터  수집</span>
knn.test.purchase &lt;-<span class="st"> </span>knn.test.data<span class="op">$</span>Purchase     <span class="co"># 테스트데이터 레이블 따로 저장</span>
knn.test.data &lt;-<span class="st"> </span>knn.test.data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select_at</span>(<span class="kw">vars</span>(<span class="op">-</span>Purchase)) <span class="co"># 테스트데이터 에서 레이블 제거</span></code></pre></div>
</div>
<div id="ClassID10-21" class="section level4">
<h4><span class="header-section-number">11.2.2.4</span> KNN 모델 만들기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(class)

knn.predicted.purchase1 &lt;-<span class="st"> </span><span class="kw">knn</span>(knn.train.data, knn.test.data, knn.train.purchase,<span class="dt">k=</span><span class="dv">1</span>)
<span class="kw">head</span>(knn.predicted.purchase1)</code></pre></div>
<pre><code>## [1] No  No  No  Yes No  No 
## Levels: No Yes</code></pre>
<ul>
<li>오분류 퍼센트를 알아봅니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(knn.test.purchase <span class="op">!=</span><span class="st"> </span>knn.predicted.purchase1)</code></pre></div>
<pre><code>## [1] 0.1134021</code></pre>
</div>
<div id="ClassID10-22" class="section level4">
<h4><span class="header-section-number">11.2.2.5</span> 적당한 K 값찾기</h4>
<ul>
<li>k 값을 3으로 주었을때</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knn.predicted.purchase3 &lt;-<span class="st"> </span><span class="kw">knn</span>(knn.train.data, knn.test.data, knn.train.purchase,<span class="dt">k=</span><span class="dv">3</span>)
<span class="kw">mean</span>(knn.test.purchase <span class="op">!=</span><span class="st"> </span>knn.predicted.purchase3)</code></pre></div>
<pre><code>## [1] 0.07216495</code></pre>
<ul>
<li>k 값을 5로 주었을때</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knn.predicted.purchase5 &lt;-<span class="st"> </span><span class="kw">knn</span>(knn.train.data, knn.test.data, knn.train.purchase,<span class="dt">k=</span><span class="dv">5</span>)
<span class="kw">mean</span>(knn.test.purchase <span class="op">!=</span><span class="st"> </span>knn.predicted.purchase5)</code></pre></div>
<pre><code>## [1] 0.06414662</code></pre>
</div>
<div id="ClassID10-23" class="section level4">
<h4><span class="header-section-number">11.2.2.6</span> k 값 자동으로 찾기</h4>
<p>우리가 1주차에 배운 for 루프를 써서 k 값을 자동으로 찾아 봅시다</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knn.predicted.purchase =<span class="st"> </span><span class="ot">NULL</span>
error.rate =<span class="st"> </span><span class="ot">NULL</span>

<span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">20</span>){
    knn.predicted.purchase =<span class="st"> </span><span class="kw">knn</span>(knn.train.data, knn.test.data, knn.train.purchase,<span class="dt">k=</span>i)
    error.rate[i] =<span class="st"> </span><span class="kw">mean</span>(knn.test.purchase <span class="op">!=</span><span class="st"> </span>knn.predicted.purchase)
}

<span class="kw">print</span>(error.rate)</code></pre></div>
<pre><code>##  [1] 0.11340206 0.10710195 0.07331042 0.07159221 0.06357388 0.06357388
##  [7] 0.06071019 0.06071019 0.06071019 0.06128293 0.05956472 0.05956472
## [13] 0.05899198 0.05899198 0.05899198 0.05899198 0.05956472 0.05956472
## [19] 0.05956472 0.05956472</code></pre>
</div>
<div id="ClassID10-24" class="section level4">
<h4><span class="header-section-number">11.2.2.7</span> Elbow 방법을 통한 k 값찾기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
k.values &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">20</span>
error.df &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(error.rate,k.values)

error.df</code></pre></div>
<pre><code>## # A tibble: 20 x 1
##     value
##     &lt;dbl&gt;
##  1 0.113 
##  2 0.107 
##  3 0.0733
##  4 0.0716
##  5 0.0636
##  6 0.0636
##  7 0.0607
##  8 0.0607
##  9 0.0607
## 10 0.0613
## 11 0.0596
## 12 0.0596
## 13 0.0590
## 14 0.0590
## 15 0.0590
## 16 0.0590
## 17 0.0596
## 18 0.0596
## 19 0.0596
## 20 0.0596</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">error.df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>k.values,<span class="dt">y=</span>error.rate)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>()<span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">color=</span><span class="st">&#39;red&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
</div>
<div id="ClassID10-25" class="section level3">
<h3><span class="header-section-number">11.2.3</span> Support Vector Machine(SVM)</h3>
<ul>
<li>support vector Machine 을 이용해서 소셜광고 후에 나이와 연봉을 수집해서 제품을 구매 할 고객인지 아닌지 예측 하는 모델을 만들어 보겠습니다.</li>
</ul>
<div id="ClassID10-26" class="section level4">
<h4><span class="header-section-number">11.2.3.1</span> 데이터셋 가져와서 테스트데이터와 훈련데이터 나누기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Support Vector Machine (SVM)</span>

<span class="co"># Importing the dataset</span>
dataset =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;Social_Network_Ads.csv&#39;</span>)
<span class="co">#dataset</span>
dataset =<span class="st"> </span>dataset[<span class="dv">3</span><span class="op">:</span><span class="dv">5</span>]

<span class="co"># 레이블을 factor형으로 변형 합니다.</span>
dataset<span class="op">$</span>Purchased =<span class="st"> </span><span class="kw">factor</span>(dataset<span class="op">$</span>Purchased, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))

<span class="co"># 훈련데이터 와 테스트 데이터로 나누기</span>
<span class="co"># install.packages(&#39;caTools&#39;)</span>
<span class="kw">library</span>(caTools)
<span class="kw">set.seed</span>(<span class="dv">123</span>)
split =<span class="st"> </span><span class="kw">sample.split</span>(dataset<span class="op">$</span>Purchased, <span class="dt">SplitRatio =</span> <span class="fl">0.75</span>) <span class="co"># 이번에는 0.75 로 나눠 봅니다.</span>
svm.train.data =<span class="st"> </span><span class="kw">subset</span>(dataset, split <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)
svm.test.data =<span class="st"> </span><span class="kw">subset</span>(dataset, split <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="ClassID10-27" class="section level4">
<h4><span class="header-section-number">11.2.3.2</span> 데이터 전처리</h4>
<ul>
<li>svm 동일 하나의 공간에서 Support Vector 를 이용해서 구분하기 때문에 Feature 에 대한 Scale이 필요합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Feature 스케일링 : 이번에는 mutate 함수를 사용하지 않고 더간단한게 scale 함수를 적용합니다.</span>
svm.train.data[<span class="op">-</span><span class="dv">3</span>] =<span class="st"> </span><span class="kw">scale</span>(svm.train.data[<span class="op">-</span><span class="dv">3</span>]) 
svm.test.data[<span class="op">-</span><span class="dv">3</span>] =<span class="st"> </span><span class="kw">scale</span>(svm.test.data[<span class="op">-</span><span class="dv">3</span>])

<span class="co"># Fitting SVM to the Training set</span>
<span class="co"># install.packages(&#39;e1071&#39;)</span></code></pre></div>
</div>
<div id="ClassID10-28" class="section level4">
<h4><span class="header-section-number">11.2.3.3</span> SVM(linear) 함수를 이용해서 모델 만들고 fitting 하기</h4>
<ul>
<li>r 에서 제공하는 svm type 은 크게 4가지 종류가 있으며 <a href="http://www.statsoft.com/Textbook/Support-Vector-Machines#Classification%20SVM">svm-type</a> 을 참조면 됩니다.</li>
<li>kernel 함수를 linear 를 사용해서 고차원 커널 트릭을 사용하지 않는 것으로 모델을 만들어 봅니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;e1071&quot;)</span>
<span class="kw">library</span>(e1071)
svm.fitted.model1 =<span class="st"> </span><span class="kw">svm</span>(<span class="dt">formula =</span> Purchased <span class="op">~</span><span class="st"> </span>.,
                 <span class="dt">data =</span> svm.train.data,
                 <span class="dt">type =</span> <span class="st">&#39;C-classification&#39;</span>,
                 <span class="dt">kernel =</span> <span class="st">&#39;linear&#39;</span>,
                 <span class="dt">probability=</span><span class="ot">TRUE</span>)

<span class="co"># 테스트 데이터로 스코어링</span>
svm.predicted.purchase1 =<span class="st"> </span><span class="kw">predict</span>(svm.fitted.model1, <span class="dt">newdata =</span> svm.test.data[<span class="op">-</span><span class="dv">3</span>],<span class="dt">decision.values=</span><span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="ClassID10-29" class="section level4">
<h4><span class="header-section-number">11.2.3.4</span> 예측 결과 테이블 확인</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Making the Confusion Matrix</span>
cm1 =<span class="st"> </span><span class="kw">table</span>(svm.test.data<span class="op">$</span>Purchased, svm.predicted.purchase1)
cm1</code></pre></div>
<pre><code>##    svm.predicted.purchase1
##      0  1
##   0 57  7
##   1 13 23</code></pre>
</div>
<div id="ClassID10-30" class="section level4">
<h4><span class="header-section-number">11.2.3.5</span> SVM(RBF) 함수를 이용해서 모델 만들고 fitting 하기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(e1071)
svm.fitted.model2=<span class="st"> </span><span class="kw">svm</span>(<span class="dt">formula =</span> Purchased <span class="op">~</span><span class="st"> </span>.,
                 <span class="dt">data =</span> svm.train.data,
                 <span class="dt">type =</span> <span class="st">&#39;C-classification&#39;</span>,
                 <span class="dt">kernel =</span> <span class="st">&#39;radial&#39;</span>, <span class="co"># RBF 커널 적용</span>
                 <span class="dt">probability=</span><span class="ot">TRUE</span>) 


<span class="co"># 두번째 모델 테스트 데이터로 스코어링</span>
svm.predicted.purchase2  =<span class="st"> </span><span class="kw">predict</span>(svm.fitted.model2, <span class="dt">newdata =</span> svm.test.data[<span class="op">-</span><span class="dv">3</span>], <span class="dt">decision.values=</span><span class="ot">TRUE</span>)

cm2=<span class="st"> </span><span class="kw">table</span>(svm.test.data<span class="op">$</span>Purchased, svm.predicted.purchase2)
cm2</code></pre></div>
<pre><code>##    svm.predicted.purchase2
##      0  1
##   0 58  6
##   1  4 32</code></pre>
</div>
<div id="ClassID10-31" class="section level4">
<h4><span class="header-section-number">11.2.3.6</span> ROC 커브그리기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;ROCR&quot;)</span>
<span class="kw">library</span>(ROCR) <span class="co"># ROC 커브를 그리기 위한 패키지</span>

<span class="co"># </span>
svm.prob1&lt;-<span class="kw">attr</span>(svm.predicted.purchase1,<span class="st">&quot;decision.values&quot;</span>)
svm.prob2&lt;-<span class="kw">attr</span>(svm.predicted.purchase2,<span class="st">&quot;decision.values&quot;</span>)

predict1 &lt;-<span class="st"> </span><span class="kw">prediction</span>(svm.prob1 , svm.test.data<span class="op">$</span>Purchased )
predict2 &lt;-<span class="st"> </span><span class="kw">prediction</span>(svm.prob2 , svm.test.data<span class="op">$</span>Purchased )


<span class="co"># 각각의 모델의 대한 TRP/ FPR 은 구합니다. </span>
perf1 &lt;-<span class="st"> </span><span class="kw">performance</span>(predict1, <span class="st">&quot;fpr&quot;</span>, <span class="st">&quot;tpr&quot;</span>) 
perf2 &lt;-<span class="st"> </span><span class="kw">performance</span>(predict2, <span class="st">&quot;fpr&quot;</span>, <span class="st">&quot;tpr&quot;</span>) 
<span class="co"># 2개의 ROC 곡선을 하나의 차트에 그립니다.</span>
<span class="kw">plot</span>(perf1, <span class="dt">col=</span><span class="dv">1</span>) 
<span class="kw">par</span>(<span class="dt">new=</span>T) <span class="co"># 첫번째 차트에 추가 해도됨.(같이 겹쳐그리기 위해)</span>
<span class="kw">plot</span>(perf2, <span class="dt">col=</span><span class="dv">2</span>) 
<span class="kw">legend</span>(<span class="fl">0.6</span>,<span class="fl">0.6</span>, <span class="kw">c</span>(<span class="st">&quot;svm.linear&quot;</span>, <span class="st">&quot;svm.rbf&quot;</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
</div>
</div>
<div id="ClassID10-32" class="section level3">
<h3><span class="header-section-number">11.2.4</span> Decision Tree Classification</h3>
<ul>
<li>Decision Tree 모델을 학습기위해 미국 대학교 정보를 바탕으로 사립 학교 인지 공립 하교 인지 맟추는 모델을 만들어 보겠습니다.</li>
<li>college 데이터를 불러오기 위해 ISRL 라이브러리를 인스톨 하고 불러옵니다.</li>
</ul>
<div id="ClassID10-33" class="section level4">
<h4><span class="header-section-number">11.2.4.1</span> 데이터셋 설명</h4>
<ul>
<li><p>데이터셋 설명</p>
<pre><code>Private A factor with levels No and Yes indicating private or public university
Apps Number of applications received
Accept Number of applications accepted
Enroll Number of new students enrolled
Top10perc Pct. new students from top 10% of H.S. class
Top25perc Pct. new students from top 25% of H.S. class
F.Undergrad Number of fulltime undergraduates
P.Undergrad Number of parttime undergraduates
Outstate Out-of-state tuition
Room.Board Room and board costs
Books Estimated book costs
Personal Estimated personal spending
PhD Pct. of faculty with Ph.D.’s
Terminal Pct. of faculty with terminal degree
S.F.Ratio Student/faculty ratio
perc.alumni Pct. alumni who donate
Expend Instructional expenditure per student
Grad.Rate Graduation rate</code></pre></li>
</ul>
</div>
<div id="ClassID10-34" class="section level4">
<h4><span class="header-section-number">11.2.4.2</span> 데이터 불러오고 EDA 수행하기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;ISRL&quot;)</span>
<span class="kw">library</span>(ISLR)
<span class="kw">head</span>(College)</code></pre></div>
<pre><code>##                              Private Apps Accept Enroll Top10perc
## Abilene Christian University     Yes 1660   1232    721        23
## Adelphi University               Yes 2186   1924    512        16
## Adrian College                   Yes 1428   1097    336        22
## Agnes Scott College              Yes  417    349    137        60
## Alaska Pacific University        Yes  193    146     55        16
## Albertson College                Yes  587    479    158        38
##                              Top25perc F.Undergrad P.Undergrad Outstate
## Abilene Christian University        52        2885         537     7440
## Adelphi University                  29        2683        1227    12280
## Adrian College                      50        1036          99    11250
## Agnes Scott College                 89         510          63    12960
## Alaska Pacific University           44         249         869     7560
## Albertson College                   62         678          41    13500
##                              Room.Board Books Personal PhD Terminal
## Abilene Christian University       3300   450     2200  70       78
## Adelphi University                 6450   750     1500  29       30
## Adrian College                     3750   400     1165  53       66
## Agnes Scott College                5450   450      875  92       97
## Alaska Pacific University          4120   800     1500  76       72
## Albertson College                  3335   500      675  67       73
##                              S.F.Ratio perc.alumni Expend Grad.Rate
## Abilene Christian University      18.1          12   7041        60
## Adelphi University                12.2          16  10527        56
## Adrian College                    12.9          30   8735        54
## Agnes Scott College                7.7          37  19016        59
## Alaska Pacific University         11.9           2  10922        15
## Albertson College                  9.4          11   9727        55</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>College</code></pre></div>
<ul>
<li>데이터 분포를 표시해보고, 숙식비용 과 졸업 비율을 이용해 사립학교와 공립학교를 구분 해봅니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;psych&quot;)</span>
<span class="kw">library</span>(psych)

<span class="kw">describe</span>(df) <span class="co"># psych 에서 제공</span></code></pre></div>
<pre><code>##             vars   n     mean      sd median  trimmed     mad    min
## Private*       1 777     1.73    0.45    2.0     1.78    0.00    1.0
## Apps           2 777  3001.64 3870.20 1558.0  2193.01 1463.33   81.0
## Accept         3 777  2018.80 2451.11 1110.0  1510.29 1008.17   72.0
## Enroll         4 777   779.97  929.18  434.0   575.95  354.34   35.0
## Top10perc      5 777    27.56   17.64   23.0    25.13   13.34    1.0
## Top25perc      6 777    55.80   19.80   54.0    55.12   20.76    9.0
## F.Undergrad    7 777  3699.91 4850.42 1707.0  2574.88 1441.09  139.0
## P.Undergrad    8 777   855.30 1522.43  353.0   536.36  449.23    1.0
## Outstate       9 777 10440.67 4023.02 9990.0 10181.66 4121.63 2340.0
## Room.Board    10 777  4357.53 1096.70 4200.0  4301.70 1005.20 1780.0
## Books         11 777   549.38  165.11  500.0   535.22  148.26   96.0
## Personal      12 777  1340.64  677.07 1200.0  1268.35  593.04  250.0
## PhD           13 777    72.66   16.33   75.0    73.92   17.79    8.0
## Terminal      14 777    79.70   14.72   82.0    81.10   14.83   24.0
## S.F.Ratio     15 777    14.09    3.96   13.6    13.94    3.41    2.5
## perc.alumni   16 777    22.74   12.39   21.0    21.86   13.34    0.0
## Expend        17 777  9660.17 5221.77 8377.0  8823.70 2730.95 3186.0
## Grad.Rate     18 777    65.46   17.18   65.0    65.60   17.79   10.0
##                 max   range  skew kurtosis     se
## Private*        2.0     1.0 -1.02    -0.96   0.02
## Apps        48094.0 48013.0  3.71    26.52 138.84
## Accept      26330.0 26258.0  3.40    18.75  87.93
## Enroll       6392.0  6357.0  2.68     8.74  33.33
## Top10perc      96.0    95.0  1.41     2.17   0.63
## Top25perc     100.0    91.0  0.26    -0.57   0.71
## F.Undergrad 31643.0 31504.0  2.60     7.61 174.01
## P.Undergrad 21836.0 21835.0  5.67    54.52  54.62
## Outstate    21700.0 19360.0  0.51    -0.43 144.32
## Room.Board   8124.0  6344.0  0.48    -0.20  39.34
## Books        2340.0  2244.0  3.47    28.06   5.92
## Personal     6800.0  6550.0  1.74     7.04  24.29
## PhD           103.0    95.0 -0.77     0.54   0.59
## Terminal      100.0    76.0 -0.81     0.22   0.53
## S.F.Ratio      39.8    37.3  0.66     2.52   0.14
## perc.alumni    64.0    64.0  0.60    -0.11   0.44
## Expend      56233.0 53047.0  3.45    18.59 187.33
## Grad.Rate     118.0   108.0 -0.11    -0.22   0.62</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Room.Board,<span class="dt">y=</span>Grad.Rate)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Private))</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<ul>
<li>정규과정 재학생의 비율을 사립과 공립을 나누어 histogram 으로 빈도를 보겠습니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(F.Undergrad)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>Private),<span class="dt">color=</span><span class="st">&#39;black&#39;</span>,<span class="dt">bins=</span><span class="dv">50</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<ul>
<li>졸업율이 100% 가 넘는 학교가 있습니다. 확인해보고 100으로 맞추겠습니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Grad.Rate =</span> <span class="kw">if_else</span>(Grad.Rate <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">100</span>,Grad.Rate )) 
<span class="co">#df</span></code></pre></div>
</div>
<div id="ClassID10-35" class="section level4">
<h4><span class="header-section-number">11.2.4.3</span> 훈련데이터 테스트 데이터 나누기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(caTools)

<span class="kw">set.seed</span>(<span class="dv">101</span>) 

sample =<span class="st"> </span><span class="kw">sample.split</span>(df<span class="op">$</span>Private, <span class="dt">SplitRatio =</span> <span class="fl">0.70</span>)
tree.train.data =<span class="st"> </span><span class="kw">subset</span>(df, sample <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>)
tree.test.data =<span class="st"> </span><span class="kw">subset</span>(df, sample <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>)</code></pre></div>
</div>
<div id="decision-tree----" class="section level4">
<h4><span class="header-section-number">11.2.4.4</span> Decision Tree 를 이용한 모델 만들기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rpart)
tree.model &lt;-<span class="st"> </span><span class="kw">rpart</span>(Private <span class="op">~</span>.,<span class="dt">method=</span><span class="st">&#39;class&#39;</span>,<span class="dt">data =</span> tree.train.data)
tree.predict &lt;-<span class="st"> </span><span class="kw">predict</span>(tree.model,tree.test.data )
<span class="kw">head</span>(tree.predict)</code></pre></div>
<pre><code>##             No       Yes
## 3  0.003311258 0.9966887
## 11 0.003311258 0.9966887
## 12 0.003311258 0.9966887
## 13 0.003311258 0.9966887
## 14 0.003311258 0.9966887
## 17 0.003311258 0.9966887</code></pre>
<ul>
<li>데이터를 보게 되면 사립학교일 확율과 사립학교가 아닐 확율 2가지를 줍니다. 하나로 합쳐 보겠습니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tree.predict &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(tree.predict)

tree.predict &lt;-<span class="st"> </span>tree.predict  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Private =</span> <span class="kw">ifelse</span>(Yes <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.5</span>, <span class="st">&#39;Yes&#39;</span>, <span class="st">&#39;No&#39;</span>))

<span class="co"># tree.predict</span></code></pre></div>
<ul>
<li>오분류 비율을 출력합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Confusion Matrix 로 구해보기</span>
<span class="kw">table</span>(tree.predict<span class="op">$</span>Private,tree.test.data<span class="op">$</span>Private)</code></pre></div>
<pre><code>##      
##        No Yes
##   No   57   9
##   Yes   7 160</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 퍼센트로 구해보기 </span>
misClasificError &lt;-<span class="st"> </span><span class="kw">mean</span>(tree.predict<span class="op">$</span>Private <span class="op">!=</span><span class="st"> </span>tree.test.data<span class="op">$</span>Private)


<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&#39;Accuracy&#39;</span>,<span class="dv">1</span><span class="op">-</span>misClasificError))</code></pre></div>
<pre><code>## [1] &quot;Accuracy 0.931330472103004&quot;</code></pre>
</div>
<div id="dicision-tree---" class="section level4">
<h4><span class="header-section-number">11.2.4.5</span> dicision tree 모델 시각화 하기</h4>
<ul>
<li>rpart 라이브러리 를 이요해서 시각화 합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;rpart.plot&quot;)</span>
<span class="kw">library</span>(rpart)
<span class="kw">library</span>(rpart.plot)
<span class="kw">prp</span>(tree.model)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
</div>
<div id="ClassID10-36" class="section level3">
<h3><span class="header-section-number">11.2.5</span> Random Forrest Classfication</h3>
<ul>
<li>동일한 데이터셋을 사용해서 Random Forrest 모델을 만들어 봅니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;randomForest&quot;)</span>
<span class="kw">library</span>(randomForest)

<span class="co"># Decision Tree 와 비교해보세요 </span>
<span class="co"># tree.model &lt;- rpart(Private ~.,method=&#39;class&#39;,data = tree.train.data)</span>
randomf.model &lt;-<span class="st"> </span><span class="kw">randomForest</span>(Private <span class="op">~</span><span class="st"> </span>. , <span class="dt">data =</span> tree.train.data,<span class="dt">importance =</span> <span class="ot">TRUE</span>)</code></pre></div>
<div id="ClassID10-37" class="section level4">
<h4><span class="header-section-number">11.2.5.1</span> 변수 중요도를 확인및 시각화</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(devtools)
<span class="co">#install_github(&#39;araastat/reprtree&#39;) #devtolls 에서 제공하는 install_github 으로 설치</span>

<span class="co"># Confusion Matrix 확인 (RandomForrest 함수 리턴값에는 confusion Matrix 가 포함되어 있습니다.)</span>
randomf.model<span class="op">$</span>confusion</code></pre></div>
<pre><code>##      No Yes class.error
## No  125  23  0.15540541
## Yes  10 386  0.02525253</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 변수 중요도 확인 (RandomForrest 함수 리턴값에 변수중요도 항목이 포함되어 있습니다..)</span>
randomf.model<span class="op">$</span>importance</code></pre></div>
<pre><code>##                       No          Yes MeanDecreaseAccuracy
## Apps        0.0299975940 1.581643e-02         0.0195732992
## Accept      0.0265169723 1.359972e-02         0.0169830344
## Enroll      0.0360668986 2.852824e-02         0.0305094654
## Top10perc   0.0094902570 5.700969e-03         0.0067307985
## Top25perc   0.0049996299 2.891095e-03         0.0035060616
## F.Undergrad 0.1591184093 6.945790e-02         0.0937286273
## P.Undergrad 0.0436610506 7.334280e-03         0.0170748529
## Outstate    0.1456738704 6.461743e-02         0.0865178571
## Room.Board  0.0147668601 1.439793e-02         0.0144179025
## Books       0.0007389787 8.914367e-05         0.0002868557
## Personal    0.0029767520 8.632755e-04         0.0014664250
## PhD         0.0086149598 5.320894e-03         0.0061979645
## Terminal    0.0044437470 6.488106e-03         0.0059953078
## S.F.Ratio   0.0302010312 8.307646e-03         0.0142830244
## perc.alumni 0.0166161199 3.455476e-03         0.0071053253
## Expend      0.0235732631 1.270668e-02         0.0155385819
## Grad.Rate   0.0149251559 5.575670e-03         0.0080482732
##             MeanDecreaseGini
## Apps                9.093474
## Accept             11.252450
## Enroll             22.810173
## Top10perc           5.535670
## Top25perc           4.568160
## F.Undergrad        38.842710
## P.Undergrad        16.934128
## Outstate           42.669650
## Room.Board         10.414502
## Books               2.203342
## Personal            3.710353
## PhD                 4.624097
## Terminal            4.524290
## S.F.Ratio          16.017899
## perc.alumni         5.280970
## Expend              9.860188
## Grad.Rate           6.520158</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#randomTree &lt;- getTree(randomf.model, 1, labelVar=TRUE)</span>

reprtree<span class="op">:::</span><span class="kw">plot.getTree</span>(randomf.model ) <span class="co"># github에서 다운받은 reptree 함수를 이용해서 트리를 그립니다.</span></code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<ul>
<li>No, Yes 답이 나오는데 기여한 정도 및 Gini 계수 를 보여 줍니다. Gini 계수가 높을수록 의사 결을을 하는데 있어서 중요한 변수(information gain 이 높다) 라고 보면 됩니다. 높은 수치가 나온 변수를 그래프로 그려보면 확연하게 느낄수 있습니다.</li>
</ul>
</div>
<div id="ClassID10-38" class="section level4">
<h4><span class="header-section-number">11.2.5.2</span> 스코어링 해보기</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">randomt.predict &lt;-<span class="st"> </span><span class="kw">predict</span>(randomf.model,tree.test.data)

<span class="kw">table</span>(randomt.predict ,tree.test.data<span class="op">$</span>Private)</code></pre></div>
<pre><code>##                
## randomt.predict  No Yes
##             No   57   6
##             Yes   7 163</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">randomt.predict</code></pre></div>
<pre><code>##   3  11  12  13  14  17  22  23  25  26  30  31  41  43  45  49  54  55 
## Yes Yes Yes Yes Yes Yes  No Yes Yes  No Yes Yes Yes Yes Yes Yes Yes Yes 
##  61  64  69  70  72  73  74  77  78  79  80  82  84  85  90  92  94  95 
## Yes Yes Yes  No Yes Yes Yes Yes Yes  No  No  No Yes Yes Yes Yes Yes Yes 
##  97 106 107 110 121 122 126 127 128 132 133 134 135 146 158 161 162 164 
## Yes Yes Yes Yes Yes Yes  No Yes Yes Yes Yes Yes Yes Yes Yes Yes  No Yes 
## 167 176 181 182 184 186 187 189 192 195 201 202 205 206 208 209 210 211 
## Yes Yes  No  No Yes Yes Yes Yes Yes Yes Yes  No Yes Yes  No Yes Yes Yes 
## 212 214 215 231 235 242 244 246 249 256 264 266 267 275 281 285 300 303 
## Yes Yes Yes Yes Yes Yes Yes  No  No Yes Yes Yes Yes  No  No Yes Yes Yes 
## 305 306 314 318 319 324 325 328 330 343 344 347 350 354 365 366 368 374 
## Yes  No Yes Yes Yes Yes  No Yes Yes Yes Yes Yes Yes Yes Yes  No  No Yes 
## 377 380 381 395 397 399 400 401 402 410 412 418 419 421 425 426 427 432 
## Yes Yes Yes Yes Yes Yes Yes Yes  No Yes  No  No  No  No Yes Yes Yes Yes 
## 440 444 446 453 455 456 458 464 468 469 475 480 488 489 490 491 497 499 
## Yes Yes  No Yes Yes Yes  No Yes Yes Yes Yes Yes Yes Yes  No Yes Yes Yes 
## 501 503 504 506 511 513 518 519 523 526 527 528 529 530 531 533 537 540 
## Yes Yes Yes Yes  No Yes Yes Yes Yes Yes Yes Yes Yes  No  No Yes  No Yes 
## 543 545 546 550 552 558 559 562 563 564 577 578 581 582 583 585 586 588 
## Yes Yes Yes Yes Yes Yes  No  No  No  No Yes Yes Yes  No Yes Yes  No Yes 
## 591 594 602 604 605 608 614 619 620 631 632 634 636 638 639 640 642 652 
## Yes Yes Yes  No  No  No Yes Yes  No Yes Yes  No  No  No  No Yes  No  No 
## 653 658 660 663 665 667 669 685 688 689 692 694 695 699 711 715 721 724 
##  No  No  No  No  No Yes Yes  No Yes Yes  No  No  No  No Yes Yes Yes Yes 
## 729 732 733 740 742 744 746 748 749 755 757 761 765 771 773 774 776 
## Yes Yes Yes Yes  No  No  No  No Yes Yes Yes Yes Yes Yes  No Yes Yes 
## Levels: No Yes</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># 오분류 확율 구하기</span>
misClasificError &lt;-<span class="st"> </span><span class="kw">mean</span>(randomt.predict <span class="op">!=</span><span class="st"> </span>tree.test.data<span class="op">$</span>Private)

<span class="kw">print</span>(<span class="kw">paste</span>(<span class="st">&#39;Accuracy&#39;</span>,<span class="dv">1</span><span class="op">-</span>misClasificError))</code></pre></div>
<pre><code>## [1] &quot;Accuracy 0.944206008583691&quot;</code></pre>
</div>
</div>
</div>
<div id="ClassID10-40" class="section level2">
<h2><span class="header-section-number">11.3</span> Clustering 군집 모델</h2>
<div id="ClassID10-41" class="section level3">
<h3><span class="header-section-number">11.3.1</span> K-Means Clustering</h3>
<ul>
<li>kmeans 클러스터링을 학습하기 위해 컴퓨터 스펙을 바탕으로 컴퓨터들을 분류 해보겠습니다.</li>
</ul>
<div id="ClassID10-42" class="section level4">
<h4><span class="header-section-number">11.3.1.1</span> 데이터 수집 및 정규화 (Scaling)</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#install.packages(&quot;animation&quot;)  </span>
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(animation)

<span class="co"># 불필요한 데이터는 제거하고 df 에 저장 합니다.</span>
computer &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;computers.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(X1,cd, multi, premium)) 


scale.computer.df &lt;-<span class="st"> </span>computer  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">price_scal =</span> <span class="kw">scale</span>(price),
         <span class="dt">hd_scal =</span> <span class="kw">scale</span>(hd),
         <span class="dt">ram_scal =</span> <span class="kw">scale</span>(ram),
         <span class="dt">screen_scal =</span> <span class="kw">scale</span>(screen),
         <span class="dt">ads_scal =</span> <span class="kw">scale</span>(ads),
         <span class="dt">trend_scal =</span> <span class="kw">scale</span>(trend))  <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(price, speed, hd, ram, screen, ads, trend)) <span class="co"># 정규화 한 다음 원래 값을 날립니다.</span>

scale.computer.df</code></pre></div>
<pre><code>## # A tibble: 6,259 x 6
##    price_scal[,1] hd_scal[,1] ram_scal[,1] screen_scal[,1] ads_scal[,1]
##             &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;           &lt;dbl&gt;        &lt;dbl&gt;
##  1       -1.24         -1.30       -0.761           -0.673        -1.70
##  2       -0.731        -1.28       -1.12            -0.673        -1.70
##  3       -1.08         -0.954      -0.761            0.432        -1.70
##  4       -0.638        -0.954      -0.0510          -0.673        -1.70
##  5        1.85         -0.296       1.37            -0.673        -1.70
##  6        2.54         -0.296       1.37            -0.673        -1.70
##  7       -0.860        -0.954      -0.761           -0.673        -1.70
##  8       -0.387        -1.28       -1.12            -0.673        -1.70
##  9        0.00934      -0.799      -0.0510          -0.673        -1.70
## 10        0.612        -0.799      -0.761            0.432        -1.70
## # … with 6,249 more rows, and 1 more variable: trend_scal[,1] &lt;dbl&gt;</code></pre>
<ul>
<li>정규화한 데이터로 animation 을 통해 kmeans clustering 이 어덯게 움직이는지 확인해 보겠습니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2345</span>)
<span class="kw">kmeans.ani</span>(scale.computer.df[<span class="dv">2</span><span class="op">:</span><span class="dv">3</span>], <span class="dv">4</span>)</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-62-1.png" width="672" /><img src="test2_files/figure-html/unnamed-chunk-62-2.png" width="672" /><img src="test2_files/figure-html/unnamed-chunk-62-3.png" width="672" /><img src="test2_files/figure-html/unnamed-chunk-62-4.png" width="672" /><img src="test2_files/figure-html/unnamed-chunk-62-5.png" width="672" /><img src="test2_files/figure-html/unnamed-chunk-62-6.png" width="672" /><img src="test2_files/figure-html/unnamed-chunk-62-7.png" width="672" /><img src="test2_files/figure-html/unnamed-chunk-62-8.png" width="672" /><img src="test2_files/figure-html/unnamed-chunk-62-9.png" width="672" /><img src="test2_files/figure-html/unnamed-chunk-62-10.png" width="672" /></p>
<ul>
<li>kmeans 클러스터링 모델을 만들고. 함수의 리턴 속성중에 R스퀘어 합을 가져오는 함수를 만듭니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kmeans.model &lt;-<span class="kw">kmeans</span>(scale.computer.df, <span class="dv">3</span>)

sum.square &lt;-<span class="st"> </span><span class="cf">function</span>(k) {
  cluster &lt;-<span class="st"> </span><span class="kw">kmeans</span>(scale.computer.df, k)
  <span class="kw">return</span> (cluster<span class="op">$</span>tot.withinss)
}
<span class="co"># 테스트 해봅니다.</span>
<span class="kw">sum.square</span>(<span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] 27087.1</code></pre>
<ul>
<li>k 의 최대 개수를 정하고, sum.square 함수를 호출해서 모델 빌드를 반복하면서 withinss 값을 저장합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># k 의 최대 개수를 지정합니다.</span>
max.k =<span class="st"> </span><span class="dv">20</span> 

<span class="co"># 모델을 20번 만들어서 R스퀘어 값을 저장합니다.</span>
total.square &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">2</span><span class="op">:</span>max.k, sum.square)

<span class="co"># 그래프를 만들 데이터 프레임을 만듭니다.</span>
elbow &lt;-<span class="kw">data.frame</span>(<span class="dv">2</span><span class="op">:</span>max.k, total.square)

<span class="kw">view</span>(elbow)
<span class="co"># Plot the graph with gglop</span></code></pre></div>
<ul>
<li>최적을 k 값을 찾기 위해 그래프를 그립니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(elbow, <span class="kw">aes</span>(X2.max.k,total.square)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dt">by =</span> <span class="dv">1</span>))</code></pre></div>
<p><img src="test2_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<ul>
<li>k 값을 7로 하고 다시 모델을 생성 하고, 생성된 클러스터 별로 군집이 몇개인지 확인 합니다.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">kmeans.model &lt;-<span class="kw">kmeans</span>(scale.computer.df, <span class="dv">7</span>)

kmeans.model<span class="op">$</span>size</code></pre></div>
<pre><code>## [1]  621  897  594 1856  538 1377  376</code></pre>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ggplot-visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="modeling-part-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["test2.pdf", "test2.epub"],
"toc": {
"collapse": "subsection",
"scroll_highlight": true,
"fontsettings": null,
"theme": "white",
"family": "sans",
"size": 1
}
});
});
</script>

</body>

</html>
